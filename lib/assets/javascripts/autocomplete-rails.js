!function(a){a.fn.railsAutocomplete=function(){var b=function(){this.railsAutoCompleter||(this.railsAutoCompleter=new a.railsAutocomplete(this))};return void 0!==a.fn.on?a(document).on("focus",this.selector,b):this.live("focus",b)},a.railsAutocomplete=function(a){_e=a,this.init(_e)},a.railsAutocomplete.fn=a.railsAutocomplete.prototype={railsAutocomplete:"0.0.1"},a.railsAutocomplete.fn.extend=a.railsAutocomplete.extend=a.extend,a.railsAutocomplete.fn.extend({init:function(b){function c(a){return a.split(b.delimiter)}function d(a){return c(a).pop().replace(/^\s+/,"")}b.delimiter=a(b).attr("data-delimiter")||null,b.min_length=a(b).attr("min-length")||2,b.append_to=a(b).attr("data-append-to")||null,a(b).autocomplete({appendTo:b.append_to,source:function(c,e){params={term:d(c.term)},a(b).attr("data-autocomplete-fields")&&a.each(a.parseJSON(a(b).attr("data-autocomplete-fields")),function(b,c){params[b]=a(c).val()}),a.getJSON(a(b).attr("data-autocomplete"),params,function(){0==arguments[0].length&&(arguments[0]=[],arguments[0][0]={id:"",label:"no existing match"}),a(arguments[0]).each(function(c,d){var e={};for(e[d.id]=d,index=0;index<Object.keys(d).length;++index)key=Object.keys(d)[index],"label"!=key&&"value"!=key&&"id"!=key&&a("#"+b.id).parents(".line_item").attr("data-q-"+key,d[key]);a(b).data(e)}),e.apply(null,arguments)})},change:function(b,c){if(a(this).is("[data-id-element]")&&""!=a(a(this).attr("data-id-element")).val()&&(a(a(this).attr("data-id-element")).val(c.item?c.item.id:""),a(this).attr("data-update-elements"))){var d=a.parseJSON(a(this).attr("data-update-elements")),e=c.item?a(this).data(c.item.id.toString()):{};if(d&&""==a(d.id).val())return;for(var f in d)element=a(d[f]),element.is(":checkbox")?null!=e[f]&&element.prop("checked",e[f]):element.val(c.item?e[f]:"")}},search:function(){var a=d(this.value);return a.length<b.min_length?!1:void 0},focus:function(){return!1},select:function(d,e){var f=c(this.value);if(f.pop(),f.push(e.item.value),null!=b.delimiter)f.push(""),this.value=f.join(b.delimiter);else if(this.value=f.join(""),a(this).attr("data-id-element")&&a(a(this).attr("data-id-element")).val(e.item.id),a(this).attr("data-update-elements")){var g=a(this).data(e.item.id.toString()),h=a.parseJSON(a(this).attr("data-update-elements"));for(var i in h)element=a(h[i]),element.is(":checkbox")?null!=g[i]&&element.prop("checked",g[i]):element.val(g[i])}var j=this.value;return a(this).bind("keyup.clearId",function(){a.trim(a(this).val())!=a.trim(j)&&(a(a(this).attr("data-id-element")).val(""),a(this).unbind("keyup.clearId"))}),a(b).trigger("railsAutocomplete.select",e),!1}})}}),a(document).ready(function(){a("input[data-autocomplete]").railsAutocomplete()})}(jQuery);